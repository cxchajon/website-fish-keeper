<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Tank Guide — Aquarium Cycling Coach & 24-Hour Challenge</title>
  <meta name="description" content="Use the Cycling Coach to enter ammonia, nitrite, and nitrate readings, track cycle progress, and take the 24-Hour Challenge for safe fishkeeping guidance — by FishKeepingLifeCo." />
  <link rel="stylesheet" href="css/style.css?v=1.0.9" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="icon" href="/favicon.ico" />
  <script defer src="js/nav.js?v=1.1.0"></script>
  <style>
    :root {
      --card-surface: rgba(14, 22, 36, 0.72);
      --card-border: rgba(255, 255, 255, 0.16);
      --muted: rgba(240, 246, 255, 0.78);
      --input-bg: rgba(8, 12, 20, 0.6);
      --input-border: rgba(255, 255, 255, 0.18);
      --chip-warn: rgba(245, 179, 1, 0.18);
      --chip-warn-text: #ffe8b5;
      --chip-warn-border: rgba(245, 179, 1, 0.4);
      --chip-plain: rgba(255, 255, 255, 0.08);
      --transition-speed: 220ms;
    }

    body.cycling-coach {
      position: relative;
      min-height: 100vh;
      padding-bottom: 120px;
    }

    .planted-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(160deg, rgba(46, 140, 90, 0.3), rgba(46, 140, 90, 0.16));
      opacity: 0;
      transition: opacity var(--transition-speed) ease;
      z-index: 0;
    }

    body.planted-active .planted-overlay {
      opacity: 1;
    }

    @media (prefers-reduced-motion: reduce) {
      .planted-overlay,
      .page-title__leaf {
        transition-duration: 0ms;
      }
    }

    #site-nav {
      position: relative;
      z-index: 20;
    }

    main {
      position: relative;
      z-index: 10;
      padding: 32px 20px 64px;
    }

    .page-wrap {
      width: min(960px, 100%);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 28px;
    }

    .page-header {
      text-align: center;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .page-header p {
      margin: 0;
      color: var(--muted);
    }

    .page-title {
      margin: 0;
      font-size: clamp(2.4rem, 3vw + 1.6rem, 3rem);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .page-title__leaf {
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
      font-size: 1.4rem;
    }

    body.planted-active .page-title__leaf {
      opacity: 1;
      transform: translateY(0);
    }

    .card {
      background: var(--card-surface);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 24px;
      backdrop-filter: blur(18px) saturate(1.4);
      -webkit-backdrop-filter: blur(18px) saturate(1.4);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .card__title {
      margin: 0;
      font-size: 1.3rem;
    }

    .info-btn {
      appearance: none;
      background: var(--chip-plain);
      border: 1px solid var(--card-border);
      border-radius: 999px;
      color: inherit;
      font-size: 0.85rem;
      line-height: 1;
      padding: 6px 8px;
      cursor: pointer;
      transition: transform 160ms ease;
    }

    .info-btn:focus-visible {
      outline: 2px solid #8cc4ff;
      outline-offset: 2px;
    }

    .info-btn:hover {
      transform: translateY(-1px);
    }

    .info-btn[data-tooltip] {
      position: relative;
    }

    .info-btn[data-tooltip]:focus::after,
    .info-btn[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 50%;
      top: calc(100% + 10px);
      transform: translateX(-50%);
      min-width: 220px;
      background: rgba(8, 12, 20, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.22);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.85rem;
      color: #f8fbff;
      line-height: 1.35;
      z-index: 30;
      pointer-events: none;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
    }

    .info-btn[data-tooltip]:focus::before,
    .info-btn[data-tooltip]:hover::before {
      content: '';
      position: absolute;
      left: 50%;
      top: calc(100% + 3px);
      transform: translateX(-50%);
      border-width: 6px;
      border-style: solid;
      border-color: rgba(255, 255, 255, 0.22) transparent transparent transparent;
      z-index: 29;
    }

    .form-grid {
      display: grid;
      gap: 18px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .label-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .field label {
      font-weight: 600;
      font-size: 0.98rem;
    }

    .field input[type="number"],
    .field select {
      width: 100%;
      padding: 12px 12px;
      border-radius: 10px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: inherit;
      font-size: 1rem;
    }

    .field input[type="number"]:focus-visible,
    .field select:focus-visible,
    .checkbox input:focus-visible {
      outline: 2px solid #8cc4ff;
      outline-offset: 2px;
    }

    .checkbox {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .checkbox input {
      width: 20px;
      height: 20px;
    }

    .form-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-start;
    }

    .btn {
      appearance: none;
      border-radius: 12px;
      border: 1px solid transparent;
      padding: 12px 22px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      color: #06121e;
      background: #f3f7ff;
      transition: transform 160ms ease, box-shadow 160ms ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(3, 10, 22, 0.35);
    }

    .btn:focus-visible {
      outline: 3px solid #8cc4ff;
      outline-offset: 2px;
    }

    .btn--secondary {
      background: transparent;
      border-color: rgba(255, 255, 255, 0.28);
      color: inherit;
      box-shadow: none;
    }

    .status-row {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .status-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      align-self: flex-start;
      font-weight: 700;
      letter-spacing: 0.01em;
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.16);
    }

    .results-summary {
      margin: 0;
      color: var(--muted);
      font-size: 0.98rem;
    }

    .actions-block {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .actions-block header {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }

    .actions-list {
      margin: 0;
      padding-left: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .actions-list li {
      line-height: 1.45;
    }

    .challenge-card {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .challenge-card h3 {
      margin: 0;
      font-size: 1.15rem;
    }

    .challenge-grid {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .chip-note {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--chip-warn);
      color: var(--chip-warn-text);
      border: 1px solid var(--chip-warn-border);
      border-radius: 999px;
      padding: 8px 14px;
      font-weight: 600;
    }

    details.advanced {
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 14px;
      padding: 0;
      background: rgba(10, 16, 28, 0.6);
      overflow: hidden;
    }

    details.advanced > summary {
      list-style: none;
      margin: 0;
      padding: 18px 20px;
      font-weight: 600;
      font-size: 1.05rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    details.advanced > summary::-webkit-details-marker {
      display: none;
    }

    .advanced-body {
      padding: 0 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .advanced-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .temp-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .temp-toggle button {
      appearance: none;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      background: transparent;
      color: inherit;
      padding: 8px 12px;
      font-weight: 600;
      cursor: pointer;
    }

    .temp-toggle button:focus-visible {
      outline: 2px solid #8cc4ff;
      outline-offset: 2px;
    }

    .advanced-output {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      font-weight: 600;
    }

    .advanced-output .value {
      font-variant-numeric: tabular-nums;
    }

    .nh3-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(226, 85, 85, 0.18);
      border: 1px solid rgba(226, 85, 85, 0.46);
      color: #ffe3e3;
      font-size: 0.85rem;
    }

    .advanced-note {
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    .advanced-note a {
      color: inherit;
    }

    footer {
      margin-top: 40px;
    }

    @media (max-width: 640px) {
      .card {
        padding: 20px;
      }

      .info-btn[data-tooltip]:focus::after,
      .info-btn[data-tooltip]:hover::after {
        left: auto;
        right: 0;
        transform: none;
      }

      .info-btn[data-tooltip]:focus::before,
      .info-btn[data-tooltip]:hover::before {
        left: auto;
        right: 12px;
        transform: none;
      }
    }
  </style>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": "https://thetankguide.com/#organization",
  "name": "FishKeepingLifeCo",
  "alternateName": "The Tank Guide",
  "url": "https://thetankguide.com",
  "addressCountry": "US",
  "addressRegion": "NY",
  "logo": "https://thetankguide.com/logo.png",
  "image": "https://thetankguide.com/logo.png",
  "slogan": "Educational Aquarium Books & Tools",
  "description": "FishKeepingLifeCo publishes educational aquarium books and interactive online tools like The Tank Guide to help aquarists of all experience levels set up, stock, and maintain thriving aquariums.",
  "brand": {
    "@type": "Brand",
    "name": "The Tank Guide"
  },
  "foundingDate": "2025-09-12",
  "publishingPrinciples": "https://thetankguide.com/about.html",
  "areaServed": ["United States", "New York"],
  "knowsAbout": [
    "Aquariums",
    "Fishkeeping",
    "Nitrogen Cycle",
    "Freshwater Aquariums",
    "Planted Tanks",
    "Aquarium Setup Basics",
    "Water Parameters",
    "Aquarium Cycling"
  ],
  "contactPoint": [
    {
      "@type": "ContactPoint",
      "contactType": "customer support",
      "email": "info@thetankguide.com",
      "availableLanguage": ["en"]
    }
  ],
  "sameAs": [
    "https://www.instagram.com/fishkeepinglifeco/",
    "https://www.tiktok.com/@fishkeepinglifeco",
    "https://www.youtube.com/@fishkeepinglifeco",
    "https://www.facebook.com/fishkeepinglifeco",
    "https://www.amazon.com/author/fishkeepinglifeco"
  ]
}
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9905718149811880"
    crossorigin="anonymous"></script>
  <!-- --- Google CMP (Funding Choices) START --- -->
  <script async src="https://fundingchoicesmessages.google.com/i/pub-9905718149811880?ers=1"></script>
  <script>
    // Required bootstrap per Google; signals CMP presence
    (function() {
      function signalGooglefcPresent() {
        if (!window.frames['googlefcPresent']) {
          if (document.body) {
            const iframe = document.createElement('iframe');
            iframe.style.cssText = 'display:none';
            iframe.name = 'googlefcPresent';
            document.body.appendChild(iframe);
          } else {
            setTimeout(signalGooglefcPresent, 0);
          }
        }
      }
      signalGooglefcPresent();
    })();
  </script>
  <!-- --- Google CMP (Funding Choices) END --- -->
</head>
<body class="theme-dark cycling-coach">
  <div id="site-nav"></div>
  <div class="planted-overlay" aria-hidden="true"></div>

  <main id="main-content">
    <div class="page-wrap" id="cycling-coach">
      <section id="cc-title" class="cc-title" aria-label="Cycling Coach header">
        <h1 class="cc-title__h1">
          Cycling Coach
          <span class="cc-title__leaf" aria-hidden="true"></span>
        </h1>
        <div class="cc-title__eyebrow">Nitrogen cycle tool</div>
        <p class="cc-title__subline">Enter today’s readings for a clear snapshot.</p>
      </section>

      <!-- === TTG AD: TOP START === -->
      <div class="ttg-adunit ttg-adunit--top" id="ad-top-1" data-ad-slot="top-1" aria-label="Advertisement">
        <!-- AdSense will mount here when approved -->
        <span>Ad — Top placeholder</span>
      </div>
      <!-- === TTG AD: TOP END === -->

      <section class="card" aria-labelledby="inputs-heading">
        <div class="card__header">
          <h2 class="card__title" id="inputs-heading">Inputs</h2>
        </div>
        <form id="coach-form" novalidate data-testid="coach-form">
          <div class="form-grid">
            <div class="field">
              <div class="label-row">
                <label for="ammonia">Ammonia (NH₃/NH₄⁺)</label>
                <button type="button" class="info-btn" data-tooltip="Waste from fish/food. Even tiny amounts are toxic." aria-label="Ammonia info" aria-describedby="tip-ammonia" data-testid="info-ammonia">ⓘ</button>
              </div>
              <input type="number" id="ammonia" name="ammonia" step="0.01" min="0" inputmode="decimal" data-testid="ammonia" />
              <span id="tip-ammonia" class="visually-hidden">Waste from fish/food. Even tiny amounts are toxic.</span>
            </div>
            <div class="field">
              <div class="label-row">
                <label for="nitrite">Nitrite (NO₂⁻)</label>
                <button type="button" class="info-btn" data-tooltip="Mid-stage of the cycle; also toxic." aria-label="Nitrite info" aria-describedby="tip-nitrite" data-testid="info-nitrite">ⓘ</button>
              </div>
              <input type="number" id="nitrite" name="nitrite" step="0.01" min="0" inputmode="decimal" data-testid="nitrite" />
              <span id="tip-nitrite" class="visually-hidden">Mid-stage of the cycle; also toxic.</span>
            </div>
            <div class="field">
              <div class="label-row">
                <label for="nitrate">Nitrate (NO₃⁻)</label>
                <button type="button" class="info-btn" data-tooltip="End product; safer but must be controlled with water changes." aria-label="Nitrate info" aria-describedby="tip-nitrate" data-testid="info-nitrate">ⓘ</button>
              </div>
              <input type="number" id="nitrate" name="nitrate" step="0.1" min="0" inputmode="decimal" data-testid="nitrate" />
              <span id="tip-nitrate" class="visually-hidden">End product; safer but must be controlled with water changes.</span>
            </div>
            <div class="field">
              <div class="label-row">
                <label for="cycle-method">Cycle Method</label>
                <button type="button" class="info-btn" data-tooltip="Fishless = add ammonia without fish. Fish-in = cycle with fish; requires extra care." aria-label="Cycle method info" aria-describedby="tip-method" data-testid="info-cycle-method">ⓘ</button>
              </div>
              <select id="cycle-method" name="cycle-method">
                <option value="fishless" selected>Fishless</option>
                <option value="fish-in">Fish-in</option>
              </select>
              <span id="tip-method" class="visually-hidden">Fishless equals adding ammonia without fish. Fish-in means cycling with fish and requires extra care.</span>
            </div>
            <div id="planted-row" class="planted-row">
              <input type="checkbox" id="planted">
              <label for="planted">This is a planted tank.</label>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn" id="check-button">Check</button>
            <button type="button" class="btn btn--secondary" id="clear-button">Clear</button>
          </div>
        </form>
      </section>

      <section class="card" aria-labelledby="results-heading">
        <div class="card__header">
          <div class="status-label">
            <h2 class="card__title" id="results-heading">Results</h2>
            <button type="button" class="info-btn" data-tooltip="High-level snapshot of where your tank stands." aria-label="Status info" aria-describedby="tip-status" data-testid="info-status">ⓘ</button>
          </div>
          <span id="tip-status" class="visually-hidden">High-level snapshot of where your tank stands.</span>
        </div>
        <div class="status-row" aria-live="polite" data-testid="result-status">
          <span class="status-badge" id="status-badge">⚪ Incomplete</span>
          <p class="results-summary" id="results-summary">Ammonia: — ppm • Nitrite: — ppm • Nitrate: — ppm • Method: Fishless • Planted: No</p>
        </div>
        <div class="actions-block" id="actions-block" hidden data-testid="result-actions">
          <header>
            <span>Action steps</span>
            <button type="button" class="info-btn" data-tooltip="Quick, practical steps based on your readings." aria-label="Action steps info" aria-describedby="tip-actions" data-testid="info-actions">ⓘ</button>
          </header>
          <span id="tip-actions" class="visually-hidden">Quick, practical steps based on your readings.</span>
          <ul class="actions-list" id="actions-list"></ul>
        </div>
      </section>

      <!-- === TTG AD: POST-RESULTS START === -->
      <div class="ttg-adunit ttg-adunit--bottom" id="ad-bottom-1" data-ad-slot="post-results-1" aria-label="Advertisement">
        <!-- AdSense will mount here when approved -->
        <span>Ad — Post-results placeholder</span>
      </div>
      <!-- === TTG AD: POST-RESULTS END === -->

      <section class="card" id="challengeCard" aria-labelledby="challenge-heading" hidden>
        <div class="card__header">
          <h2 class="card__title" id="challenge-heading">24-Hour Challenge</h2>
          <button type="button" class="info-btn" data-tooltip="Shows your filter can process 2 ppm ammonia to 0 ammonia and 0 nitrite in 24 hours." aria-label="Challenge info" aria-describedby="tip-challenge" data-testid="info-challenge">ⓘ</button>
          <span id="tip-challenge" class="visually-hidden">Shows your filter can process two ppm ammonia to zero ammonia and zero nitrite in twenty-four hours.</span>
        </div>
        <div class="challenge-card">
          <p class="challenge-instructions" id="challengeInstruction">Dose to ~2 ppm, wait 24 hours, then enter the readings below.</p>
          <button type="button" class="btn" id="challenge-start">Start 24-hour challenge</button>
          <div class="challenge-grid" id="challenge-form" hidden>
            <div class="field">
              <label for="challengeAmmonia">Ammonia after 24h</label>
              <input type="number" id="challengeAmmonia" step="0.01" min="0" inputmode="decimal" />
              <p class="field-error" id="challenge-ammonia-error" hidden></p>
            </div>
            <div class="field">
              <label for="challengeNitrite">Nitrite after 24h</label>
              <input type="number" id="challengeNitrite" step="0.01" min="0" inputmode="decimal" />
              <p class="field-error" id="challenge-nitrite-error" hidden></p>
            </div>
          </div>
          <button type="button" class="btn" id="challenge-check" hidden>Check results</button>
          <div id="challengeMessage"></div>
          <div class="actions-block" id="challenge-results" hidden>
            <header>
              <span>Challenge test</span>
              <button type="button" class="info-btn" data-tooltip="Shows your filter can process 2 ppm ammonia to 0 ammonia and 0 nitrite in 24 hours." aria-label="Challenge test info" aria-describedby="tip-challenge-inline" data-testid="info-challenge-inline">ⓘ</button>
            </header>
            <span id="tip-challenge-inline" class="visually-hidden">Shows your filter can process two ppm ammonia to zero ammonia and zero nitrite in twenty-four hours.</span>
            <ul class="actions-list" id="challenge-list"></ul>
          </div>
        </div>
      </section>

      <details class="advanced" id="advanced-panel">
        <summary aria-controls="advanced-content" aria-expanded="false">Advanced (optional)</summary>
        <div class="advanced-body" id="advanced-content">
          <div class="advanced-grid">
            <div class="field">
              <label for="ph">pH</label>
              <input type="number" id="ph" name="ph" step="0.1" inputmode="decimal" data-testid="ph" />
            </div>
            <div class="field">
              <label for="temperature">Temperature</label>
              <div class="temp-toggle">
                <input type="number" id="temperature" name="temperature" step="0.1" inputmode="decimal" data-testid="temp" />
                <button type="button" id="temp-toggle" aria-label="Switch temperature unit">°F</button>
              </div>
            </div>
          </div>
          <div class="advanced-output" aria-live="polite">
            <span>Estimated toxic NH₃:</span>
            <span class="value" id="nh3-value">—</span>
            <span class="nh3-badge" id="nh3-badge" hidden>⚠️ Caution</span>
            <button type="button" class="info-btn" data-tooltip="Test kits read TAN (NH₃ + NH₄⁺). Only NH₃ is toxic and increases with pH/temperature." aria-label="Advanced NH3 info" aria-describedby="tip-advanced" data-testid="info-advanced">ⓘ</button>
            <span id="tip-advanced" class="visually-hidden">Test kits read TAN, which is NH3 plus NH4. Only NH3 is toxic and increases with pH and temperature.</span>
          </div>
          <p class="advanced-note"><a href="/media.html" target="_blank" rel="noopener">See Media page for Sources &amp; Further Reading.</a></p>
        </div>
      </details>

      <section id="cc-bottom" class="cc-bottom" aria-label="About Cycling Coach">
        <p class="home-subtext cc-disclaimer">Cycling Coach is an educational tool. Always confirm with your own testing and judgment before making aquarium decisions.</p>
        <p class="home-blurb cc-seo">Cycling Coach is your aquarium cycling assistant. Enter your test results for ammonia (NH₃/NH₄⁺), nitrite (NO₂⁻), and nitrate (NO₃⁻) to see how your tank is progressing through the nitrogen cycle. Whether you’re doing a fishless cycle or cycling with fish, the tool helps you track water parameters, understand the next steps, and maintain a safe environment for your fish.</p>
      </section>
    </div>
  </main>

  <div id="site-footer"></div>
<script>
(async () => {
  try {
    const res = await fetch('/footer.v1.3.0.html?v=1.3.0', { cache: 'no-cache' });
    const html = await res.text();
    const host = document.getElementById('site-footer');
    if (host) host.outerHTML = html;
  } catch (e) { console.error('[Footer] load failed:', e); }
})();
</script>
  <script type="module" src="js/params.js?v=2.0.0"></script>
<!-- === TTG Cookie Consent START === -->
<div id="ttg-consent" class="ttg-consent" hidden>
  <div class="ttg-consent__inner" role="dialog" aria-labelledby="ttg-consent-title" aria-describedby="ttg-consent-desc">
    <h3 id="ttg-consent-title">Cookies & Advertising</h3>
    <p id="ttg-consent-desc">
      We use cookies to run this site and (if you allow) to show relevant ads from Google AdSense. You can accept all cookies, reject personalized ads, or manage preferences anytime.
    </p>
    <div class="ttg-consent__actions">
      <button type="button" class="ttg-btn ttg-btn--secondary" id="ttg-consent-reject">Reject (Non-personalized)</button>
      <button type="button" class="ttg-btn ttg-btn--ghost" id="ttg-consent-manage">Manage</button>
      <button type="button" class="ttg-btn ttg-btn--primary" id="ttg-consent-accept">Accept All</button>
    </div>
  </div>
</div>

<div id="ttg-consent-modal" class="ttg-consent-modal" hidden aria-modal="true" role="dialog" aria-labelledby="ttg-consent-modal-title">
  <div class="ttg-consent-modal__panel">
    <h3 id="ttg-consent-modal-title">Cookie Preferences</h3>
    <form id="ttg-consent-form">
      <label class="ttg-row">
        <input type="checkbox" checked disabled />
        <span><strong>Essential</strong> — required for core site functions.</span>
      </label>
      <label class="ttg-row">
        <input type="checkbox" id="ttg-c-analytics" />
        <span><strong>Analytics</strong> — understand usage (if enabled later).</span>
      </label>
      <label class="ttg-row">
        <input type="checkbox" id="ttg-c-ads" />
        <span><strong>Advertising</strong> — allow personalized ads (Google AdSense).</span>
      </label>
      <div class="ttg-consent-modal__actions">
        <button type="button" class="ttg-btn ttg-btn--ghost" id="ttg-consent-cancel">Cancel</button>
        <button type="submit" class="ttg-btn ttg-btn--primary">Save Preferences</button>
      </div>
    </form>
  </div>
</div>

<!-- === TTG Cookie Consent SCRIPT (checkbox fix + status) START === -->
<script>
(function(){
  const KEY = 'ttg.consent.v1';

  const $banner = document.getElementById('ttg-consent');
  const $modal  = document.getElementById('ttg-consent-modal');
  const $btnAccept = document.getElementById('ttg-consent-accept');
  const $btnReject = document.getElementById('ttg-consent-reject');
  const $btnManage = document.getElementById('ttg-consent-manage');
  const $btnCancel = document.getElementById('ttg-consent-cancel');
  const $form = document.getElementById('ttg-consent-form');

  // Checkboxes
  const $rows        = $form ? $form.querySelectorAll('.ttg-row') : [];
  const $ckEssential = $rows[0] ? $rows[0].querySelector('input[type="checkbox"]') : null;
  const $ckAnalytics = document.getElementById('ttg-c-analytics');
  const $ckAds       = document.getElementById('ttg-c-ads');

  // Add a small status line so you can verify state visually
  let $status = $form ? $form.querySelector('.ttg-consent-status') : null;
  if ($form && !$status){
    $status = document.createElement('p');
    $status.className = 'ttg-consent-status';
    $form.appendChild($status);
  }

  function updateStatus(){
    if(!$status) return;
    const a = $ckAnalytics && $ckAnalytics.checked ? 'ON' : 'OFF';
    const d = $ckAds && $ckAds.checked ? 'ON' : 'OFF';
    $status.textContent = `Current: Analytics ${a} • Advertising ${d}`;
  }

  function save(state){
    localStorage.setItem(KEY, JSON.stringify(state));
    document.documentElement.setAttribute('data-ad-consent', state.ads ? 'granted' : 'denied');
    window.dispatchEvent(new CustomEvent('ttg:consent-change'));
  }
  function load(){
    try { return JSON.parse(localStorage.getItem(KEY) || ''); } catch(e){ return null; }
  }
  function openBanner(){ if (typeof window.__tcfapi === 'function') { return; } if ($banner) $banner.hidden = false; }
  function closeBanner(){ if ($banner) $banner.hidden = true; }
  function openModal(){
    if(!$modal) return;
    $modal.hidden = false;

    // Essential MUST be checked & disabled
    if ($ckEssential){
      $ckEssential.checked = true;
      $ckEssential.disabled = true;
    }

    const s = load() || {analytics:false, ads:false};
    if ($ckAnalytics) $ckAnalytics.checked = !!s.analytics;
    if ($ckAds)       $ckAds.checked = !!s.ads;
    updateStatus();
  }
  function closeModal(){ if($modal) $modal.hidden = true; }

  // Ensure modal hidden initially
  closeModal();

  const state = load();
  if (!state){
    // First visit: banner only
    openBanner();
  } else {
    save(state);
    closeBanner(); closeModal();
  }

  // Wire up clicks on the whole row to toggle the checkbox (except Essential)
  $rows.forEach(function(row, idx){
    row.addEventListener('click', function(e){
      const cb = row.querySelector('input[type="checkbox"]');
      if (!cb) return;
      if (idx === 0) return; // Essential: no toggle
      if (e.target.tagName.toLowerCase() !== 'input'){
        cb.checked = !cb.checked;
        updateStatus();
      }
    });
  });
  if ($ckAnalytics) $ckAnalytics.addEventListener('change', updateStatus);
  if ($ckAds)       $ckAds.addEventListener('change', updateStatus);

  // Buttons
  if ($btnAccept) $btnAccept.addEventListener('click', function(){
    save({ essential:true, analytics:true, ads:true, ts:Date.now() });
    closeModal(); closeBanner();
  });
  if ($btnReject) $btnReject.addEventListener('click', function(){
    save({ essential:true, analytics:false, ads:false, ts:Date.now() });
    closeModal(); closeBanner();
  });
  if ($btnManage) $btnManage.addEventListener('click', openModal);
  if ($btnCancel) $btnCancel.addEventListener('click', closeModal);

  if ($form) $form.addEventListener('submit', function(e){
    e.preventDefault();
    save({
      essential: true,
      analytics: $ckAnalytics ? !!$ckAnalytics.checked : false,
      ads:       $ckAds ? !!$ckAds.checked : false,
      ts: Date.now()
    });
    closeModal(); closeBanner();
  });

  // Close modal on outside click
  if ($modal) $modal.addEventListener('click', function(e){
    if (e.target === $modal) closeModal();
  });

  // Close on Escape
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && $modal && !$modal.hidden) closeModal();
  });

  // Guard for ad scripts
  if (document.documentElement.getAttribute('data-ad-consent') !== 'granted'){
    window.__TTG_ADS_DISABLED__ = true;
  }

  // Public API for footer link
  window.cookieConsent = {
    open: function(){ openModal(); },
    reset: function(){ localStorage.removeItem(KEY); closeModal(); openBanner(); }
  };
})();
</script>
<!-- === TTG Cookie Consent SCRIPT (checkbox fix + status) END === -->

<!-- === TTG Consent → Ad Visibility Controller START === -->
<script>
(function(){
  var KEY = 'ttg.consent.v1';

  function hasGranted(){
    try {
      var s = JSON.parse(localStorage.getItem(KEY) || '');
      return !!(s && s.ads === true);
    } catch(e){ return false; }
  }

  function applyConsentToDOM(){
    var granted = hasGranted();
    document.documentElement.setAttribute('data-ad-consent', granted ? 'granted' : 'denied');
    document.documentElement.classList.toggle('is-ads-disabled', !granted);

    // If we’re only showing placeholders (no AdSense yet),
    // simply un-hide or keep hidden via the CSS above.
    // (When you later enable the AdSense loader, mount units here if granted.)
  }

  // Run now
  applyConsentToDOM();

  // Listen for same-page consent changes (buttons & form), then update immediately
  ['ttg-consent-accept','ttg-consent-reject'].forEach(function(id){
    var el = document.getElementById(id);
    if (el) el.addEventListener('click', function(){ setTimeout(applyConsentToDOM, 0); });
  });
  var form = document.getElementById('ttg-consent-form');
  if (form) form.addEventListener('submit', function(){ setTimeout(applyConsentToDOM, 0); });

  // If your cookie script dispatches a custom event, react to it too
  window.addEventListener('ttg:consent-change', applyConsentToDOM);

  // Cross-tab changes (Storage event)
  window.addEventListener('storage', function(e){
    if (e.key === KEY) applyConsentToDOM();
  });
})();
</script>
<!-- === TTG Consent → Ad Visibility Controller END === -->
<!-- === TTG CMP Consent Bridge START === -->
<script>
(function(){
  // Helper: map TCF consent to our single "ads granted" flag.
  // We consider "granted" only when Purpose 1 (storage) AND Purpose 4 (select personalised ads)
  // are consented. If you want to allow NON-personalised ads when only Purpose 1 is granted,
  // set allowNPA=true below.
  var allowNPA = true; // if true, we’ll treat Purpose 1 only as "granted" for showing slots (Google will serve NPA ads).

  function setAdConsent(granted){
    document.documentElement.setAttribute('data-ad-consent', granted ? 'granted' : 'denied');
    document.documentElement.classList.toggle('is-ads-disabled', !granted);
    // Inform any listeners (our ad loader later)
    window.dispatchEvent(new CustomEvent('ttg:consent-change', {detail:{granted}}));
  }

  // If Google CMP is present, it defines __tcfapi.
  function hookTCF(){
    if (typeof window.__tcfapi !== 'function') return false;

    // Hide our local cookie banner when Google CMP is running (EEA users).
    try{
      var banner = document.getElementById('ttg-consent');
      var modal  = document.getElementById('ttg-consent-modal');
      if (banner) banner.hidden = true;
      if (modal)  modal.hidden  = true;
    }catch(e){}

    // Listen for consent changes
    window.__tcfapi('addEventListener', 2, function(tcData, ok){
      if(!ok || !tcData) return;
      // Purpose 1 = storage; Purpose 4 = personalised ads
      var p = (tcData.purpose && tcData.purpose.consents) || {};
      var hasP1 = !!p[1];
      var hasP4 = !!p[4];

      var granted = allowNPA ? hasP1 : (hasP1 && hasP4);
      setAdConsent(granted);
    });

    // Also fetch current state once
    window.__tcfapi('getTCData', 2, function(tcData, ok){
      if(!ok || !tcData) return;
      var p = (tcData.purpose && tcData.purpose.consents) || {};
      var hasP1 = !!p[1];
      var hasP4 = !!p[4];
      var granted = allowNPA ? hasP1 : (hasP1 && hasP4);
      setAdConsent(granted);
    });

    return true;
  }

  // Try to hook immediately; if CMP loads a bit later, poll briefly
  if (!hookTCF()){
    var tries = 0, t = setInterval(function(){
      tries++;
      if (hookTCF() || tries > 40) clearInterval(t); // up to ~4s
    }, 100);
  }

  // Fallback for non-EEA visitors (no __tcfapi): keep using our local preference
  // Our existing local banner writes ttg.consent.v1 with {ads:true|false}.
  // If CMP absent, keep existing behavior (do not force-show anything here).

})();
</script>
<!-- === TTG CMP Consent Bridge END === -->

<!-- === TTG Cookie Consent END === -->

</body>
</html>
