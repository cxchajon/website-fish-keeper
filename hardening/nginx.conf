server {
  listen 80;
  listen [::]:80;
  server_name thetankguide.com www.thetankguide.com;
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  server_name thetankguide.com www.thetankguide.com;

  root /var/www/thetankguide;
  index index.html;

  # TLS config placeholders
  ssl_certificate /etc/letsencrypt/live/thetankguide.com/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/thetankguide.com/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;

  add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;
  add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' data: https://www.gstatic.com/recaptcha/ https://www.google.com/recaptcha/; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' https://formspree.io https://www.google.com/recaptcha/; frame-src 'self' https://www.youtube-nocookie.com https://www.youtube.com; frame-ancestors 'none'; form-action 'self' https://formspree.io; base-uri 'self'; object-src 'none'; upgrade-insecure-requests" always;
  add_header Referrer-Policy "strict-origin-when-cross-origin" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Permissions-Policy "accelerometer=(), ambient-light-sensor=(), autoplay=(), camera=(), cross-origin-isolated=(), display-capture=(), encrypted-media=(), fullscreen=(), geolocation=(), gyroscope=(), keyboard-map=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=(self), publickey-credentials-get=(), screen-wake-lock=(), usb=(), web-share=()" always;
  add_header X-Frame-Options "DENY" always;
  add_header Cross-Origin-Opener-Policy "same-origin" always;
  add_header Cross-Origin-Embedder-Policy "credentialless" always;
  add_header Cross-Origin-Resource-Policy "same-origin" always;
  add_header X-Permitted-Cross-Domain-Policies "none" always;

  location / {
    try_files $uri $uri/ =404;
    add_header Cache-Control "public, max-age=600";
  }

  location = /ads.txt {
    try_files /ads.txt =404;
    access_log off;
  }

  location /assets/ {
    add_header Cache-Control "public, max-age=31536000, immutable";
  }

  # Disable directory listings
  autoindex off;
}
