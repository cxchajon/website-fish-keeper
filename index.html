<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FishKeeper AI ‚Äî Stocking Calculator</title>
<style>
  :root{
    --gap:12px; --radius:14px;
    --ink:#0f172a; --muted:#475569; --muted-2:#94a3b8;
    --brand:#0284c7; --brand-2:#0369a1;
    --ok:#10b981; --ok-2:#059669;
    --warn:#f59e0b; --warn-2:#d97706;
    --bg:#f8fafc; --card:#ffffff; --line:#e2e8f0;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    color:var(--ink); background:linear-gradient(180deg,#e6f3fb 0%, #f8fafc 40%) fixed;
  }
  header{
    padding:20px clamp(16px,3vw,32px);
    display:flex; align-items:center; justify-content:space-between;
  }
  h1{font-size:clamp(20px,3.5vw,28px); margin:0;}
  .wrap{
    display:grid; gap:var(--gap);
    grid-template-columns: 1fr;
    padding:0 clamp(16px,3vw,32px) 48px;
    max-width:1200px; margin:0 auto;
  }
  @media(min-width:960px){
    .wrap{grid-template-columns:1.1fr .9fr}
  }
  .card{
    background:var(--card); border:1px solid var(--line);
    border-radius:var(--radius); padding:18px; box-shadow:0 10px 22px rgba(2,8,23,.04);
  }
  .title{display:flex; align-items:center; gap:10px; margin-bottom:12px; font-weight:700}
  .muted{color:var(--muted)}
  .row{display:flex; gap:var(--gap); flex-wrap:wrap; align-items:center}
  select, input[type="number"]{
    border:1px solid var(--line); border-radius:12px; padding:10px 12px; font-size:14px; min-width:160px; background:#fff;
  }
  button{
    border:0; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer;
  }
  .btn{background:var(--brand); color:#fff}
  .btn:hover{background:var(--brand-2)}
  .btn-ghost{background:#eef6fb; color:var(--brand); border:1px solid #dbeafe}
  .btn-ghost:hover{background:#e0f2fe}
  .btn-warn{background:var(--warn); color:#111827}
  .btn-warn:hover{background:var(--warn-2); color:#fff}
  .stack{display:flex; flex-direction:column; gap:10px}
  .list{display:flex; flex-direction:column; gap:8px}
  .item{
    display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center;
    border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff;
  }
  .item-title{font-weight:700}
  .qty-controls{display:flex; align-items:center; gap:8px}
  .icon-btn{
    display:inline-grid; place-items:center; width:34px; height:34px;
    border:1px solid var(--line); background:#fff; border-radius:10px; cursor:pointer;
  }
  .icon-btn:hover{background:#f1f5f9}
  .pill{
    font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#f8fafc; color:var(--muted);
  }
  .footer{
    display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between;
    margin-top:10px; color:var(--muted);
  }
  .warning{
    display:none; margin-top:10px; padding:10px 12px; border-radius:10px;
    background:#fffbeb; border:1px solid #fde68a; color:#7c2d12;
  }
  .warning.show{display:block}
  .totals{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
</style>
</head>
<body>
<header>
  <h1>FishKeeper AI ‚Äî Stocking Calculator</h1>
  <span class="pill">Sandbox build</span>
</header>

<main class="wrap">
  <!-- ADD FISH -->
  <section class="card">
    <div class="title">‚ûï Add Fish</div>
    <div class="stack">
      <div class="row">
        <select id="speciesSelect" aria-label="Species">
          <!-- Populated by JS -->
        </select>
        <input id="qtyInput" type="number" min="1" max="99" value="1" aria-label="Quantity"/>
        <button id="addBtn" class="btn">Add to Stock</button>
        <button id="clearBtn" class="btn-ghost" title="Clear current stock">Clear</button>
      </div>
      <small class="muted">Tip: Adding the same species again will increase its count.</small>
    </div>
  </section>

  <!-- CURRENT STOCK -->
  <section class="card">
    <div class="title">üêü Current Stock</div>
    <div id="stockList" class="list"></div>
    <div class="footer">
      <div class="totals">
        <strong>Total fish: <span id="totalCount">0</span></strong>
        <span class="pill">Bio-load: <span id="bioloadScore">0</span></span>
      </div>
      <button id="exportBtn" class="btn-ghost">Export JSON</button>
    </div>
    <div id="warnBox" class="warning"></div>
  </section>

  <!-- QUICK RULES -->
  <section class="card">
    <div class="title">‚ö†Ô∏è Quick Warnings</div>
    <ul class="stack muted" style="margin:0; padding-left:18px">
      <li>Male Bettas should not be housed together (aggression risk).</li>
      <li>Schooling fish (e.g., tetras, rasboras) do best in groups of 6+.</li>
      <li>Increase slowly to avoid ammonia spikes during cycling.</li>
    </ul>
  </section>
</main>

<script>
/** ---- Simple Species DB (extend as needed) ---- */
const SPECIES = [
  { id:'betta_male', name:'Betta (Male)', category:'betta', bio:3, aggression:'high' },
  { id:'betta_female', name:'Betta (Female)', category:'betta', bio:3, aggression:'medium' },
  { id:'cardinal_tetra', name:'Cardinal Tetra', category:'schooling', bio:1, aggression:'low' },
  { id:'neon_tetra', name:'Neon Tetra', category:'schooling', bio:1, aggression:'low' },
  { id:'cherry_barb', name:'Cherry Barb', category:'schooling', bio:1, aggression:'low' },
  { id:'kuhli_loach', name:'Kuhli Loach', category:'bottom', bio:2, aggression:'low' },
  { id:'panda_loach', name:'Panda Loach', category:'bottom', bio:2, aggression:'low' },
  { id:'amano_shrimp', name:'Amano Shrimp', category:'invertebrate', bio:0.5, aggression:'low' },
  { id:'nerite_snail', name:'Nerite Snail', category:'invertebrate', bio:0.4, aggression:'low' },
];

/** ---- State ----
 * stockMap: Map<speciesId, {id, name, qty, bio, aggression, category}>
 */
const stockMap = new Map();

/** ---- DOM ---- */
const speciesSelect = document.getElementById('speciesSelect');
const qtyInput = document.getElementById('qtyInput');
const addBtn = document.getElementById('addBtn');
const clearBtn = document.getElementById('clearBtn');
const stockList = document.getElementById('stockList');
const totalCountEl = document.getElementById('totalCount');
const bioloadScoreEl = document.getElementById('bioloadScore');
const warnBox = document.getElementById('warnBox');
const exportBtn = document.getElementById('exportBtn');

/** ---- Init ---- */
function initSelect(){
  speciesSelect.innerHTML = SPECIES
    .map(s => `<option value="${s.id}">${s.name}</option>`)
    .join('');
}
initSelect();
render();

/** ---- Helpers ---- */
function safeQty(n){
  const v = parseInt(n, 10);
  if (isNaN(v)) return 1;
  return Math.min(99, Math.max(1, v));
}

function getSpeciesById(id){
  return SPECIES.find(s => s.id === id);
}

/** ---- Core Actions ---- */
function addFish(id, qty){
  const s = getSpeciesById(id);
  if(!s) return;

  const existing = stockMap.get(id);
  if(existing){
    existing.qty = safeQty(existing.qty + qty); // INCREMENT existing
    stockMap.set(id, existing);
  }else{
    stockMap.set(id, { ...s, qty: safeQty(qty) });
  }
  render();
}

function setQty(id, qty){
  const item = stockMap.get(id);
  if(!item) return;
  item.qty = safeQty(qty);
  if(item.qty <= 0) stockMap.delete(id);
  render();
}

function inc(id){
  const item = stockMap.get(id); if(!item) return;
  item.qty = safeQty(item.qty + 1);
  render();
}

function dec(id){
  const item = stockMap.get(id); if(!item) return;
  item.qty = safeQty(item.qty - 1);
  if(item.qty <= 0) stockMap.delete(id);
  render();
}

function removeItem(id){
  stockMap.delete(id);
  render();
}

function clearAll(){
  stockMap.clear();
  render();
}

/** ---- Metrics & Warnings ---- */
function computeTotals(){
  let total = 0;
  let bio = 0;
  stockMap.forEach(v => {
    total += v.qty;
    bio += v.qty * v.bio;
  });
  return { total, bio: Math.round(bio * 10) / 10 };
}

function generateWarnings(){
  const notes = [];
  // Bettas: multiple males -> warn
  const maleBettas = stockMap.get('betta_male')?.qty ?? 0;
  if(maleBettas >= 2){
    notes.push('Multiple male Bettas detected ‚Äî high aggression risk.');
  }
  // Schooling rule: if any schooling species present with qty < 6 -> warn
  stockMap.forEach(v => {
    if(v.category === 'schooling' && v.qty > 0 && v.qty < 6){
      notes.push(`${v.name}: recommended groups of 6 or more.`);
    }
  });
  // Simple bioload heuristic
  const { bio } = computeTotals();
  if(bio >= 40){
    notes.push('High bioload ‚Äî consider slowing additions and boosting filtration.');
  } else if(bio >= 25){
    notes.push('Moderate bioload ‚Äî add fish slowly and monitor ammonia/nitrite.');
  }
  return notes;
}

/** ---- Render ---- */
function render(){
  // List
  const rows = [];
  stockMap.forEach(v => {
    rows.push(`
      <div class="item" data-id="${v.id}">
        <div>
          <div class="item-title">${v.name}</div>
          <div class="muted">Bio ${v.bio} ‚Ä¢ ${v.category} ‚Ä¢ ${v.aggression} aggression</div>
        </div>
        <div class="qty-controls">
          <button class="icon-btn" data-act="dec" title="Decrease">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M5 12h14" stroke="#0f172a" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <input class="qty-field" type="number" min="1" max="99" value="${v.qty}" aria-label="Quantity for ${v.name}" />
          <button class="icon-btn" data-act="inc" title="Increase">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M12 5v14M5 12h14" stroke="#0f172a" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button class="icon-btn" data-act="remove" title="Remove">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M6 6l12 12M18 6L6 18" stroke="#7f1d1d" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>
    `);
  });
  stockList.innerHTML = rows.join('') || `<div class="muted">No fish added yet.</div>`;

  // Totals
  const { total, bio } = computeTotals();
  totalCountEl.textContent = total;
  bioloadScoreEl.textContent = bio;

  // Warnings
  const notes = generateWarnings();
  if(notes.length){
    warnBox.classList.add('show');
    warnBox.innerHTML = `<strong>Heads up:</strong><br>${notes.map(n=>`‚Ä¢ ${n}`).join('<br>')}`;
  }else{
    warnBox.classList.remove('show');
    warnBox.textContent = '';
  }

  wireListControls();
}

/** ---- Event Wiring ---- */
addBtn.addEventListener('click', () => {
  const id = speciesSelect.value;
  const qty = safeQty(qtyInput.value);
  addFish(id, qty);
  // keep last qty typed; comment next line if you prefer reset to 1
  // qtyInput.value = '1';
});

clearBtn.addEventListener('click', clearAll);

exportBtn.addEventListener('click', () => {
  const payload = [];
  stockMap.forEach(v => payload.push({ id:v.id, name:v.name, qty:v.qty, bio:v.bio, aggression:v.aggression, category:v.category }));
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'stock.json'; a.click();
  URL.revokeObjectURL(url);
});

function wireListControls(){
  // buttons
  stockList.querySelectorAll('.item').forEach(row => {
    const id = row.getAttribute('data-id');
    row.querySelectorAll('button').forEach(btn => {
      const act = btn.getAttribute('data-act');
      if(act === 'inc') btn.onclick = () => inc(id);
      if(act === 'dec') btn.onclick = () => dec(id);
      if(act === 'remove') btn.onclick = () => removeItem(id);
    });
    // qty input direct edit
    const qtyField = row.querySelector('.qty-field');
    qtyField.addEventListener('change', (e) => {
      setQty(id, safeQty(e.target.value));
    });
  });
}
</script>
</body>
</html>