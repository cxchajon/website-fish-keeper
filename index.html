<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Stocking Calculator</title>
<style>
  :root {
    --gap: 12px;
    --radius: 14px;

    --ink: #0f172a;
    --muted: #475569;
    --muted-2: #94a3b8;

    /* Brand & UI */
    --brand:  #0284c7;  /* blue */
    --brand-2:#0369a1;
    --ok:   #10b981;    /* green */
    --ok-2: #059669;
    --warn: #f59e0b;    /* amber */
    --warn-2:#d97706;
    --bad:  #ef4444;    /* red */
    --bad-2:#dc2626;

    /* Background gradient */
    --g1:#0ea5e9; --g2:#38bdf8; --g3:#7dd3fc;

    /* Cards */
    --card: rgba(224,242,254,0.92);   /* soft aqua */
    --card-border: rgba(15,23,42,0.06);

    /* Field boxes */
    --field-bg:#ffffff;
    --field-bd:#d2dbe6;
  }

  * { box-sizing:border-box; }

  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color:var(--ink);
    background: var(--g1);
    background: linear-gradient(180deg,var(--g1) 0%,var(--g2) 60%,var(--g3) 100%);
    background-attachment: fixed;
  }

  .wrap{ max-width:980px; margin:0 auto; padding:28px 20px 48px; }

  /* Brand */
  .brand{ display:flex; flex-direction:column; align-items:flex-start; gap:4px; margin-bottom:8px; color:#fff; }
  .brand-name{ font-size:1.6rem; font-weight:700; line-height:1.2; }
  .brand-sub{ font-size:1rem; opacity:.95; }

  header{ margin-bottom:16px; text-align:left; color:#fff; }
  header h2{ margin:0; font-size:1.2rem; font-weight:600; opacity:.95; }

  /* Cards */
  .card{
    background:var(--card);
    border:1px solid var(--card-border);
    border-radius:var(--radius);
    padding:20px;
    margin-bottom:20px;
    box-shadow:0 8px 18px -10px rgba(2,6,23,.22);
    backdrop-filter: blur(6px) saturate(140%);
    -webkit-backdrop-filter: blur(6px) saturate(140%);
    overflow:hidden;
  }
  .card h2,.card h3{ margin:0 0 10px; font-weight:700; }

  /* Form basics */
  label{ font-weight:700; margin-bottom:6px; display:block; }
  input,select{
    width:100%; padding:10px; border:1px solid var(--field-bd); border-radius:10px; background:#fff;
  }

  .row{
    display:grid; gap:var(--gap);
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    align-items:end;
  }

  /* Buttons */
  .btn{
    border:none; color:#fff; cursor:pointer; font-weight:700;
    border-radius:10px; padding:10px 14px;
    background:var(--brand);
    transition: transform .06s ease, background .2s ease, box-shadow .2s ease;
    box-shadow:0 2px 8px rgba(2,6,23,.18);
  }
  .btn:hover{ background:var(--brand-2); }
  .btn:active{ transform:translateY(1px); }
  .btn:disabled{ opacity:.7; cursor:not-allowed; }

  /* ===== Current Stock ===== */

  /* Desktop/tablet table */
  .stock-table{ width:100%; border-collapse:collapse; }
  .stock-table thead th{
    padding:8px 6px 10px;
    text-align:left; font-weight:700;
    border-bottom:1px solid #cfe7fb66;
  }
  .right{ text-align:right; }

  .stock-table tbody td{ padding:10px 6px; }

  .field{
    background:var(--field-bg);
    border:1px solid var(--field-bd);
    border-radius:10px;
    padding:10px 12px;
    height:40px;
    display:flex; align-items:center;
    min-width:0;
  }
  .field.single-line{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .field.center{ justify-content:center; }
  .field.small{ min-width:60px; justify-content:center; font-variant-numeric: tabular-nums; }

  /* Thin status bar instead of thick glow */
  .field.ok   { border-color: #94e6c0; box-shadow: inset 0 0 0 2px #94e6c033; }
  .field.warn { border-color: #f6c76a; box-shadow: inset 0 0 0 2px #f6c76a33; }
  .field.bad  { border-color: #f2a3a3; box-shadow: inset 0 0 0 2px #f2a3a333; }

  /* Actions */
  .actions-wrap{ display:flex; justify-content:flex-end; align-items:center; gap:8px; }
  .pill{ height:34px; padding:0 10px; border-radius:999px; font-size:.95rem; }
  .pill.minus{ background:var(--warn); }
  .pill.minus:hover{ background:var(--warn-2); }
  .pill.plus{ background:var(--ok); }
  .pill.plus:hover{ background:var(--ok-2); }
  .pill.delete{ background:var(--bad); }
  .pill.delete:hover{ background:var(--bad-2); }

  /* ===== Mobile layout: turn each row into a mini-card ===== */
  @media (max-width: 520px){
    /* Hide thead on phones */
    .stock-table thead{ display:none; }

    .stock-table tbody tr{
      display:grid;
      grid-template-columns: 1fr auto; /* name spans, action column at right */
      grid-template-rows: auto auto;   /* name row + meta row */
      gap:8px 10px;
      padding:10px 12px;
      border:1px solid #cfe7fb66;
      border-radius:12px;
      background:#f0f9ffb3;
      margin-bottom:12px;
    }
    .stock-table tbody td{ padding:0; border:0; }

    /* Name takes full width on first row */
    td.cell-name{ grid-column: 1 / -1; }
    td.cell-name .field{ height:38px; }

    /* Meta row: qty | aggression | actions */
    td.cell-qty   { grid-column: 1 / 2; }
    td.cell-agg   { grid-column: 2 / 3; }
    td.cell-act   { grid-column: 1 / -1; }

    /* Align qty & agg next to each other, actions below (saves width) */
    .row-meta{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
    .actions-wrap{ justify-content:flex-start; flex-wrap:wrap; gap:8px; }
    .pill{ height:34px; padding:0 12px; }
    .pill.delete{ min-width:100px; }
  }

  /* Bars & notes */
  .bar{ height:24px; background:#e2e8f0; border-radius:999px; overflow:hidden; }
  .bar-fill{ height:100%; width:0%; background:linear-gradient(90deg, var(--ok), var(--warn), var(--bad)); transition:width .25s ease; }
  .bar-note{ display:flex; justify-content:space-between; font-size:.85rem; color:var(--muted); }

  small.note{ color:var(--muted-2); font-size:.8rem; font-style:italic; display:block; margin-top:6px; padding-left:20px; position:relative; }
  small.note::before{ content:"ℹ️"; position:absolute; left:0; }

  /* Warnings */
  #aggression-warnings > div{
    background:#fff7ed; border:2px solid #fdba74; color:#7a3419;
    padding:12px 14px; border-radius:12px; line-height:1.4; margin-bottom:8px;
  }
</style>
</head>
<body>
  <div class="wrap">
    <!-- Brand -->
    <div class="brand" aria-label="FishkeepingLifeCo — Aquarium Education">
      <div class="brand-name">FishkeepingLifeCo</div>
      <div class="brand-sub">Aquarium Education</div>
    </div>

    <header><h2>Stocking Calculator</h2></header>

    <!-- Tank setup -->
    <section class="card">
      <h2>Add Fish</h2>
      <div class="row">
        <div style="flex:1 1 320px">
          <label for="fishSearch">Search species</label>
          <input id="fishSearch" type="text" placeholder="Type to filter the list"/>
        </div>
      </div>
      <div class="row">
        <div style="flex:1 1 320px">
          <label for="fishSelect">Species</label>
          <select id="fishSelect"></select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1 1 200px">
          <label for="recMin">Recommended minimum</label>
          <input id="recMin" type="number" value="" disabled/>
        </div>
      </div>
      <div class="row">
        <div style="flex:1 1 200px">
          <label for="fQty">Quantity</label>
          <input id="fQty" type="number" min="1"/>
        </div>
        <div><button id="addFish" class="btn">Add</button></div>
      </div>
    </section>

    <section class="card">
      <h2>Current Stock</h2>
      <table class="stock-table">
        <thead>
          <tr>
            <th>Name</th>
            <th class="right">Qty</th>
            <th class="right">Aggression</th>
            <th class="right">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="row" style="margin-top:10px">
        <div><button id="reset" class="btn" style="background:var(--bad)">Clear Stock</button></div>
      </div>
    </section>

    <section class="card">
      <h2>Aggression & Compatibility Warnings</h2>
      <div id="aggression-warnings"></div>
    </section>
  </div>

  <script src="js/fish-data.js"></script>
  <script src="js/aggression.js"></script>

  <!-- UI polish & responsive stock rows -->
  <script>
    const tbody = document.getElementById('tbody');
    const warningsBox = document.getElementById('aggression-warnings');

    function wrapField(td, { single=false, center=false, small=false } = {}){
      if(!td) return;
      const existing = td.querySelector('.field');
      if(existing) return existing;
      const box = document.createElement('div');
      box.className = 'field';
      if(single) box.classList.add('single-line');
      if(center) box.classList.add('center');
      if(small)  box.classList.add('small');
      const text = td.textContent.trim();
      td.textContent = '';
      box.textContent = text;
      td.appendChild(box);
      return box;
    }

    function tidyActions(td){
      if(!td) return;
      if(td.querySelector('.actions-wrap')) return;
      const wrap = document.createElement('div');
      wrap.className = 'actions-wrap';
      const buttons = [...td.querySelectorAll('button')];
      buttons.forEach(b=>{
        const t = b.textContent;
        b.classList.add('btn','pill');
        if(/delete/i.test(t)){ b.classList.add('delete'); }
        else if(t.includes('-')){ b.classList.add('minus'); }
        else if(t.includes('+')){ b.classList.add('plus'); }
        wrap.appendChild(b);
      });
      td.innerHTML = '';
      td.appendChild(wrap);
    }

    function colorAggression(fieldEl, percentText){
      if(!fieldEl) return;
      const n = parseFloat(String(percentText).replace('%',''));
      fieldEl.classList.remove('ok','warn','bad');
      if(Number.isNaN(n)) return;
      if(n <= 33) fieldEl.classList.add('ok');
      else if(n <= 66) fieldEl.classList.add('warn');
      else fieldEl.classList.add('bad');
    }

    function parseWarnings(){
      const map = new Map();
      if(!warningsBox) return map;
      [...warningsBox.querySelectorAll('div')].forEach(div=>{
        const s = div.textContent || '';
        const m = s.match(/^\s*([^:]+):.*\((\d+)\s*\/\s*(\d+)\)/i);
        if(m){ map.set(m[1].trim().toLowerCase(), { qty:+m[2], min:+m[3] }); }
      });
      return map;
    }

    function applyRowEnhancements(){
      const warnMap = parseWarnings();

      [...tbody.querySelectorAll('tr')].forEach(tr=>{
        const tds = tr.querySelectorAll('td');
        if(tds.length < 4) return;

        tds[0].classList.add('cell-name');
        tds[1].classList.add('cell-qty');
        tds[2].classList.add('cell-agg');
        tds[3].classList.add('cell-act');

        const fName = wrapField(tds[0], { single:true });
        const fQty  = wrapField(tds[1], { center:true, small:true });
        const fAgg  = wrapField(tds[2], { center:true, small:true });
        tidyActions(tds[3]);

        // Color aggression
        colorAggression(fAgg, fAgg.textContent);

        // Group-size status from warning list (if any)
        const key = (fName.textContent || '').trim().toLowerCase();
        [fName,fQty].forEach(el=> el && el.classList.remove('ok','warn','bad'));
        const info = warnMap.get(key);
        if(info){
          const redCutoff = Math.max(1, Math.floor(info.min/2));
          if(info.qty < redCutoff){ fName.classList.add('bad'); fQty.classList.add('bad'); }
          else { fName.classList.add('warn'); fQty.classList.add('warn'); }
        } else {
          fName.classList.add('ok'); fQty.classList.add('ok');
        }

        /* On phones, build a compact second line for qty/agg/actions */
        if (window.matchMedia('(max-width: 520px)').matches) {
          // Ensure qty + agg share a row visually: we already rely on CSS grid,
          // but we add a wrapper to actions so it sits on its own row.
          if(!tds[3].querySelector('.actions-wrap')) tidyActions(tds[3]);
        }
      });
    }

    const obs = new MutationObserver(applyRowEnhancements);
    obs.observe(tbody, { childList:true, subtree:true });

    const warnObs = new MutationObserver(applyRowEnhancements);
    warnObs.observe(warningsBox, { childList:true, subtree:true });

    window.addEventListener('DOMContentLoaded', applyRowEnhancements);
  </script>

  <script src="js/stocking_advisor.js"></script>
</body>
</html>