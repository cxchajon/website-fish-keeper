<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://thetankguide.com/assets/img/logos/logo-1200x630.png" />
  <meta name="twitter:image:alt" content="FishKeepingLifeCo logo (1200√ó630)." />
  <meta property="og:image" content="https://thetankguide.com/assets/img/logos/logo-1200x630.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:alt" content="FishKeepingLifeCo logo (1200√ó630)." />
  <link rel="preload" href="/footer.html?v=1.5.2" as="fetch" crossorigin="anonymous">
  <meta charset="UTF-8" />
  <meta property="og:site_name" content="The Tank Guide" />
  <!-- Google tag (gtag.js) ‚Äî GA4 -->
  <!--#include virtual="/includes/ga4.html" -->
  <script src="/assets/js/ga4-fallback.js" data-ga4-loader defer></script>
  <!-- Consent Mode defaults (runs after GA loader) -->
  <script src="/assets/js/consent-mode.js" defer></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aquarium Journal Dashboard ‚Äî The Tank Guide</title>
  <meta name="description" content="Internal aquarium tracker that visualizes nitrate, dosing, and feeding logs used for Tank Guide editorial experiments." />
  <meta name="robots" content="noindex,nofollow" />
  <link rel="canonical" href="https://thetankguide.com/journal-dashboard.html" />
  <!-- NOINDEX: internal dashboard, not for public indexing -->

  <!-- Chart.js + Datalabels -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>

  <style>
    /* ====== Base / Background ====== */
    .journal-dashboard *,
    .journal-dashboard *::before,
    .journal-dashboard *::after { margin:0; padding:0; box-sizing:border-box; }
    body.journal-dashboard{
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#0a0e1a;
      color:#e4e6eb;
      padding:20px;
      padding-bottom:80px; /* keep footer clear */
      background-image:
        linear-gradient(rgba(30,144,255,.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(30,144,255,.05) 1px, transparent 1px);
      background-size:50px 50px;
    }

    /* ====== Header ====== */
    .journal-dashboard .dashboard-header{
      text-align:center;
      margin-bottom:40px;
      padding:30px;
      background:linear-gradient(135deg,#1a2332 0%, #0f1620 100%);
      border-radius:15px;
      border:1px solid rgba(30,144,255,.2);
      box-shadow:0 8px 32px rgba(0,0,0,.4);
    }
    .journal-dashboard .dashboard-header h1{
      font-size:2.4rem;
      margin-bottom:10px;
      background:linear-gradient(90deg,#1e90ff,#00bfff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .journal-dashboard .dashboard-header p{ color:#8b9dc3; font-size:1.05rem; }

    /* ====== Stats ====== */
    .journal-dashboard .dashboard-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px,1fr));
      gap:20px;
      margin-bottom:40px;
    }
    .journal-dashboard .dashboard-card{
      background:linear-gradient(135deg,#1a2332 0%, #0f1620 100%);
      padding:20px;
      border-radius:12px;
      border:1px solid rgba(30,144,255,.3);
      box-shadow:0 4px 16px rgba(0,0,0,.3);
      transition:transform .2s, box-shadow .2s;
    }
    .journal-dashboard .dashboard-card:hover{ transform:translateY(-4px); box-shadow:0 8px 20px rgba(30,144,255,.25); }
    .journal-dashboard .dashboard-label{ color:#8b9dc3; font-size:.9rem; margin-bottom:8px; text-transform:uppercase; letter-spacing:.06em; }
    .journal-dashboard .dashboard-value{ font-size:2rem; font-weight:700; color:#1e90ff; }
    .journal-dashboard .dashboard-subtext{ color:#6b7c99; font-size:.85rem; margin-top:6px; }

    /* ====== Charts ====== */
    .journal-dashboard .chart-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(520px,1fr));
      gap:25px;
      margin-bottom:40px;
    }
    .journal-dashboard .chart-card{
      background:linear-gradient(135deg,#1a2332 0%, #0f1620 100%);
      padding:24px;
      border-radius:12px;
      border:1px solid rgba(30,144,255,.3);
      box-shadow:0 4px 16px rgba(0,0,0,.3);
    }
    .journal-dashboard .chart-card h2{
      color:#1e90ff;
      font-size:1.25rem;
      margin-bottom:14px;
      border-bottom:2px solid rgba(30,144,255,.2);
      padding-bottom:8px;
    }
    .journal-dashboard .chart-wrapper{ position:relative; height:400px; }
    .journal-dashboard .full-width{ grid-column:1 / -1; }

    /* ====== Timelines ====== */
    .journal-dashboard .timeline-section{
      background:linear-gradient(135deg,#1a2332 0%, #0f1620 100%);
      padding:25px;
      border-radius:12px;
      border:1px solid rgba(30,144,255,.3);
      box-shadow:0 4px 16px rgba(0,0,0,.3);
      margin-bottom:40px;
    }
    .journal-dashboard .timeline-section h2{
      color:#1e90ff;
      margin-bottom:15px;
      border-bottom:2px solid rgba(30,144,255,.2);
      padding-bottom:8px;
    }
    .journal-dashboard .timeline-item{
      background:rgba(30,144,255,.05);
      border-left:4px solid #1e90ff;
      padding:15px;
      margin-bottom:12px;
      border-radius:8px;
    }
    .journal-dashboard .timeline-date{ color:#1e90ff; font-weight:700; margin-bottom:5px; }
    .journal-dashboard .timeline-type{
      display:inline-block; background:#1e90ff; color:#0a0e1a;
      padding:4px 10px; border-radius:5px; font-size:.85rem; font-weight:700; margin-bottom:8px;
    }
    .journal-dashboard .timeline-content{ color:#c4c8d0; line-height:1.6; }
    .journal-dashboard .milestone{ background:rgba(255,215,0,.1); border-left-color:#ffd700; }
    .journal-dashboard .milestone .timeline-type{ background:#ffd700; }

    /* ====== Responsive ====== */
    @media (max-width: 1024px){
      .journal-dashboard .chart-wrapper{ height:360px; }
    }
    @media (max-width: 768px){
      .journal-dashboard .chart-grid{ grid-template-columns:1fr; }
      .journal-dashboard .chart-wrapper{ height:320px; }
      .journal-dashboard .dashboard-header h1{ font-size:1.9rem; }
    }
</style>
  <!-- Consent Mode defaults (load FIRST) -->
  <script src="/assets/js/consent-mode.js" defer></script>
  <!-- --- Google CMP (Funding Choices) START --- -->
  <script async src="https://fundingchoicesmessages.google.com/i/pub-9905718149811880?ers=1"></script>
  <script>
    // Required bootstrap per Google; signals CMP presence
    (function() {
      function signalGooglefcPresent() {
        if (!window.frames['googlefcPresent']) {
          if (document.body) {
            const iframe = document.createElement('iframe');
            iframe.style.cssText = 'display:none';
            iframe.name = 'googlefcPresent';
            document.body.appendChild(iframe);
          } else {
            setTimeout(signalGooglefcPresent, 0);
          }
        }
      }
      signalGooglefcPresent();
    })();
  </script>
  <!-- --- Google CMP (Funding Choices) END --- -->
</head>

<body class="journal-dashboard">
  <script defer src="/js/nav.js?v=1.1.0"></script>
  <div id="site-nav"></div>
  <div class="dashboard-header">
    <h1>üê† Aquarium Monitoring Dashboard</h1>
    <p>Real-time tracking of water parameters, feeding schedules, and maintenance</p>
  </div>

  <!-- ====== STATS ====== -->
  <div class="dashboard-grid">
    <div class="dashboard-card">
      <div class="dashboard-label">Current Nitrate</div>
      <div class="dashboard-value" id="currentNitrate">‚Äî</div>
      <div class="dashboard-subtext">ppm</div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-label">Days Since WC</div>
      <div class="dashboard-value" id="daysSinceWC">‚Äî</div>
      <div class="dashboard-subtext" id="lastWCSub">Last: ‚Äî</div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-label">Total Feedings</div>
      <div class="dashboard-value" id="totalFeedings">‚Äî</div>
      <div class="dashboard-subtext">Since Sep 9</div>
    </div>
    <div class="dashboard-card">
      <div class="dashboard-label">System Status</div>
      <div class="dashboard-value" style="font-size:1.5rem;">‚úì Stable</div>
      <div class="dashboard-subtext">Post-maintenance</div>
    </div>
  </div>

  <!-- ====== CHARTS ====== -->
  <div class="chart-grid">
    <div class="chart-card full-width">
      <h2>üìä Nitrate Levels Over Time</h2>
      <div class="chart-wrapper"><canvas id="nitrateChart"></canvas></div>
    </div>

    <div class="chart-card">
      <h2>üçΩÔ∏è Feeding Distribution</h2>
      <div class="chart-wrapper"><canvas id="feedingChart"></canvas></div>
    </div>

    <div class="chart-card">
      <h2>üíß Dosing Frequency</h2>
      <div class="chart-wrapper"><canvas id="dosingChart"></canvas></div>
    </div>

    <div class="chart-card full-width">
      <h2>üìÖ Weekly Activity Timeline</h2>
      <div class="chart-wrapper"><canvas id="activityChart"></canvas></div>
    </div>
  </div>

  <!-- ====== TIMELINES ====== -->
  <div class="timeline-section">
    <h2>üéØ Recent Milestones & Key Events</h2>
    <div id="milestones"></div>
  </div>

  <div class="timeline-section">
    <h2>üìù Recent Activity Log</h2>
    <div id="recentActivity"></div>
  </div>

  <script>
    // ====== DATA (unchanged, from user) ======
    const aquariumData = [
      { date: '2025-09-09', type: 'Feeding', detail: 'veggie-only (zucchini/spinach or wafers)', notes: 'Scheduled feeding' },
      { date: '2025-09-10', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Scheduled feeding' },
      { date: '2025-09-11', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Scheduled feeding' },
      { date: '2025-09-12', type: 'Feeding', detail: 'flakes only', notes: 'Scheduled feeding' },
      { date: '2025-09-15', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Scheduled feeding' },
      { date: '2025-09-16', type: 'Feeding', detail: 'veggie-only (zucchini/spinach or wafers)', notes: 'Scheduled feeding' },
      { date: '2025-09-17', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Scheduled feeding' },
      { date: '2025-09-18', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Scheduled feeding' },
      { date: '2025-09-19', type: 'Feeding', detail: 'flakes only', notes: 'Scheduled feeding' },
      { date: '2025-09-22', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Scheduled feeding' },
      { date: '2025-09-23', type: 'Feeding', detail: 'veggie-only (zucchini/spinach or wafers)', notes: 'Scheduled feeding' },
      { date: '2025-09-24', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Scheduled feeding' },
      { date: '2025-09-25', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Completed feeding: flakes and ~half cube brine shrimp' },
      { date: '2025-09-29', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot dose', notes: 'Method: spot dose with circulation on' },
      { date: '2025-09-29', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Pinch of flakes + ~half cube brine shrimp' },
      { date: '2025-09-30', type: 'Feeding', detail: 'algae wafers + flakes', notes: 'Three algae wafers and some flakes' },
      { date: '2025-10-01', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine fertilizer dose' },
      { date: '2025-10-01', type: 'Dosing', detail: 'Seachem Excel ‚Äî 1 capful + spot dose', notes: 'Method: capful + spot dose' },
      { date: '2025-10-01', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Standard Wednesday mix' },
      { date: '2025-10-01', type: 'Parameters', detail: 'Nitrate: 5-10 ppm', notes: 'Water test', nitrate: 7.5 },
      { date: '2025-10-02', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine fertilizer dose' },
      { date: '2025-10-02', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Fed flakes and ~half cube brine shrimp' },
      { date: '2025-10-02', type: 'Parameters', detail: 'Nitrate: 5-10 ppm', notes: 'Water test', nitrate: 7.5 },
      { date: '2025-10-03', type: 'Feeding', detail: 'flakes only', notes: 'Light day' },
      { date: '2025-10-03', type: 'Parameters', detail: 'Nitrate: 10-20 ppm (‚âà20)', notes: 'Water test', nitrate: 20 },
      { date: '2025-10-06', type: 'Dosing', detail: 'Seachem Excel ‚Äî 2 capfuls', notes: 'Dose at low water level during WC' },
      { date: '2025-10-06', type: 'Feeding', detail: 'none', notes: 'Skipped feeding due to late water change' },
      { date: '2025-10-06', type: 'Maintenance', detail: 'Water change + plant trimming', notes: 'Performed ~95% sump / ~80% display; removed dead/melted leaves' },
      { date: '2025-10-06', type: 'Parameters', detail: 'Nitrate: 10-20 ppm (~20)', notes: 'Pre-water change', nitrate: 20 },
      { date: '2025-10-07', type: 'Dosing', detail: 'Seachem Excel ‚Äî 1 capful + spot dose', notes: 'Method: spot + cap' },
      { date: '2025-10-07', type: 'Feeding', detail: 'flakes + algae wafers', notes: 'Veggie day deviation: included flakes' },
      { date: '2025-10-08', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine dose' },
      { date: '2025-10-08', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Small pinch flakes + ~2 spoonfuls bloodworms' },
      { date: '2025-10-09', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine dose' },
      { date: '2025-10-09', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Normal Thursday mix' },
      { date: '2025-10-09', type: 'Parameters', detail: 'Nitrate: 5-10 ppm', notes: 'Water test', nitrate: 7.5 },
      { date: '2025-10-10', type: 'Feeding', detail: 'flakes + brine shrimp + bloodworms', notes: 'High-protein pre-trip feeding; lights extended ~2 hrs' },
      { date: '2025-10-10', type: 'Maintenance', detail: 'Water change + refugium trim + light replanting', notes: '90% sump / 80% display' },
      { date: '2025-10-10', type: 'Parameters', detail: 'Nitrate: ~10 ppm', notes: 'Pre-water change', nitrate: 10 },
      { date: '2025-10-14', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine dose after fast' },
      { date: '2025-10-14', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Post-vacation recovery feeding' },
      { date: '2025-10-14', type: 'Parameters', detail: 'Nitrate: 5-10 ppm', notes: 'Water test', nitrate: 7.5 },
      { date: '2025-10-15', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Schedule adjustment: chose brine instead of bloodworms' },
      { date: '2025-10-15', type: 'Parameters', detail: 'Nitrate: ~10 ppm', notes: 'Water test', nitrate: 10 },
      { date: '2025-10-16', type: 'Feeding', detail: 'algae wafers + brine shrimp + bloodworms', notes: 'Heavy mixed feeding (pre-light-day preparation)' },
      { date: '2025-10-16', type: 'Parameters', detail: 'Nitrate: 10-20 ppm (closer to 10)', notes: 'Water test', nitrate: 12 },
      { date: '2025-10-20', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Post-maintenance feeding; resumed routine after filter change' },
      { date: '2025-10-20', type: 'Maintenance', detail: 'Full system reset (WC + filter change + trim/replant)', notes: '~90% sump / ~70% display; replaced all filters; added Poly-fil' },
      { date: '2025-10-20', type: 'Parameters', detail: 'Nitrate: 20‚Äì40 ppm (closer to 20)', notes: 'Pre-water change', nitrate: 22 },
      { date: '2025-10-20', type: 'Checkpoint', detail: 'Start of Pre-Stocking Observation Week (Oct 20‚Äì27)', notes: 'Major Maintenance Cycle', milestone: true },
      { date: '2025-10-21', type: 'Feeding', detail: 'algae wafers + light flakes', notes: 'Fish largely ignored wafers so added small flakes' },
      { date: '2025-10-21', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot dose', notes: 'Light Excel spot dose during observation phase' },
      { date: '2025-10-22', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Pre-Stocking Observation Week' },
      { date: '2025-10-22', type: 'Parameters', detail: 'Nitrate: 5 ppm', notes: 'Pre-Stocking Observation Week', nitrate: 5 },
      { date: '2025-10-22', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot dose', notes: 'Light maintenance dose; Excel spot dose before fertilizer' },
      { date: '2025-10-22', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: '2 pumps with sump off, then 2 more with sump on' },
      { date: '2025-10-23', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Pre-Stocking Observation Week' },
      { date: '2025-10-23', type: 'Parameters', detail: 'Nitrate: 5‚Äì10 ppm (closer to 5)', notes: 'Pre-Stocking Observation Week', nitrate: 6 },
      { date: '2025-10-23', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine fertilizer dose' },
      { date: '2025-10-23', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot + 1 capful', notes: 'Spot dose before main circulation, followed by standard capful dose' },
      { date: '2025-10-26', type: 'Maintenance', detail: 'Water change + trimming + glass cleaning', notes: '~90% sump / ~75% display; trimmed dead leaves' },
      { date: '2025-10-26', type: 'Dosing', detail: 'Seachem Excel ‚Äî general + spot treatment', notes: 'Targeting remaining BBA on equipment' },
      { date: '2025-10-27', type: 'Parameters', detail: 'Nitrate: 5 ppm or less', notes: 'Stable post-maintenance', nitrate: 4 },
      { date: '2025-10-27', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot + 1 capful', notes: 'Targeted BBA on random flow generator' },
      { date: '2025-10-27', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Standard Monday feeding; strong appetite observed' },
      { date: '2025-10-28', type: 'Feeding', detail: 'algae wafers + flakes', notes: 'Fed 3 algae wafers and a small amount of flakes' },
      { date: '2025-10-28', type: 'Parameters', detail: 'Nitrate: 5 ppm', notes: 'Stable nutrient level', nitrate: 5 },
      { date: '2025-10-28', type: 'Dosing', detail: 'NilocG Thrive Plus ‚Äî 4 pumps', notes: 'Routine fertilizer dosing following water test' },
      { date: '2025-10-29', type: 'Parameters', detail: 'Nitrate: 10 ppm', notes: 'Stable post-observation reading', nitrate: 10 },
      { date: '2025-10-29', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot + 1 capful', notes: 'Targeted BBA near random flow generator' },
      { date: '2025-10-29', type: 'Feeding', detail: 'flakes + bloodworms', notes: 'Observed normal appetite; continued balanced diet' },
      { date: '2025-10-30', type: 'Parameters', detail: 'Nitrate: 10‚Äì20 ppm (closer to 20)', notes: 'Slight nutrient increase', nitrate: 18 },
      { date: '2025-10-30', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Routine Thursday feeding; strong appetite observed' },
      { date: '2025-10-30', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot + 1 capful', notes: 'Continued BBA treatment; algae turned fully red' },
      { date: '2025-10-30', type: 'Checkpoint', detail: 'Post-Treatment Recovery Week', notes: 'Start of BBA die-off monitoring', milestone: true },
      { date: '2025-10-31', type: 'Feeding', detail: 'flakes only', notes: 'End-of-week light feeding' },
      { date: '2025-11-02', type: 'Parameters', detail: 'Nitrate: 20‚Äì40 ppm (closer to 20)', notes: 'Pre-water-change reading', nitrate: 22 },
      { date: '2025-11-02', type: 'Maintenance', detail: 'Water change + light trimming', notes: '~95% sump / ~70% display; observed new plant growth' },
      { date: '2025-11-02', type: 'Dosing', detail: 'Seachem Excel ‚Äî spot + 1 capful', notes: 'Targeted residual BBA areas' },
      { date: '2025-11-03', type: 'Feeding', detail: 'flakes + brine shrimp', notes: 'Standard Monday feeding; healthy appetite observed' },
      { date: '2025-11-03', type: 'Dosing', detail: 'Seachem Excel ‚Äî 2 spot doses', notes: 'Routine spot treatment; maintaining low BBA presence' },
      { date: '2025-11-03', type: 'Observation', detail: 'Malaysian trumpet snails observed cleaning sump overflow screen', notes: 'Natural Balance Discovery milestone', milestone: true }
    ];

    // ====== Quick helpers ======
    const fmtDate = (iso) => {
      try {
        const [y,m,d] = iso.split('-');
        return `${m}/${d}`;
      } catch { return iso; }
    };
    const lastWC = new Date('2025-11-02');
    const today = new Date('2025-11-03');

    // ====== Stats ======
    const feedings = aquariumData.filter(d => d.type === 'Feeding' && d.detail !== 'none');
    const nitrateData = aquariumData.filter(d => d.type === 'Parameters' && typeof d.nitrate === 'number');
    const daysSinceWC = Math.floor( (today - lastWC) / (1000*60*60*24) );
    document.getElementById('totalFeedings').textContent = feedings.length;
    document.getElementById('daysSinceWC').textContent = daysSinceWC;
    document.getElementById('lastWCSub').textContent = 'Last: Nov 2, 2025';
    document.getElementById('currentNitrate').textContent =
      nitrateData.length ? String(nitrateData[nitrateData.length-1].nitrate) : '‚Äî';

    // ====== Chart common ======
    Chart.register(ChartDataLabels);
    const gridColor = 'rgba(30, 144, 255, 0.12)';
    const tickColor = '#9bb0cc';

    // ====== Nitrate (line + point date labels) ======
    const nitrateCtx = document.getElementById('nitrateChart').getContext('2d');

    // calculate step for datalabel density based on count
    const nCount = nitrateData.length;
    const labelStep = nCount > 18 ? 3 : nCount > 12 ? 2 : 1;

    new Chart(nitrateCtx, {
      type: 'line',
      data: {
        labels: nitrateData.map(d => d.date),
        datasets: [{
          label: 'Nitrate (ppm)',
          data: nitrateData.map(d => d.nitrate),
          borderColor: '#3aa6ff',
          backgroundColor: 'rgba(58,166,255,0.18)',
          fill: true,
          tension: 0.35,
          borderWidth: 3,
          pointRadius: 5,
          pointHoverRadius: 7,
          pointBackgroundColor: '#3aa6ff',
          pointBorderColor: '#0a0e1a',
          pointBorderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: { color: '#e4e6eb', font: { size: 13 } }
          },
          datalabels: {
            formatter: (v, ctx) => {
              const i = ctx.dataIndex;
              return (i % labelStep === 0) ? fmtDate(ctx.chart.data.labels[i]) : '';
            },
            align: 'top',
            anchor: 'end',
            offset: 4,
            color: '#e8f3ff',
            font: { weight: '600', size: 10 },
            textStrokeColor: '#0a0e1a',
            textStrokeWidth: 3,
            clip: false
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 45,
            grid: { color: gridColor },
            ticks: {
              color: tickColor,
              callback: (v) => `${v} ppm`
            }
          },
          x: {
            grid: { color: gridColor },
            ticks: { display: false } // hide bottom mush; we use datalabels
          }
        }
      }
    });

    // ====== Feeding Distribution (doughnut) ======
    const feedingTypes = {};
    feedings.forEach(f => {
      const key = f.detail.toLowerCase();
      feedingTypes[key] = (feedingTypes[key] || 0) + 1;
    });
    const feedingCtx = document.getElementById('feedingChart').getContext('2d');
    new Chart(feedingCtx, {
      type: 'doughnut',
      data: {
        labels: Object.keys(feedingTypes),
        datasets: [{
          data: Object.values(feedingTypes),
          backgroundColor: ['#3aa6ff','#00c4ff','#5fb3ff','#7ecbff','#9bd8ff','#00ced1','#5f9ea0'],
          borderColor: '#0a0e1a',
          borderWidth: 2
        }]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{ position:'bottom', labels:{ color:'#e4e6eb', padding:14, font:{ size:11 } } }
        }
      }
    });

    // ====== Dosing Frequency (bar) ======
    const dosings = aquariumData.filter(d => d.type === 'Dosing');
    const dosingTypes = {};
    dosings.forEach(d => {
      const product = d.detail.split('‚Äî')[0].trim();
      dosingTypes[product] = (dosingTypes[product] || 0) + 1;
    });
    const dosingCtx = document.getElementById('dosingChart').getContext('2d');
    new Chart(dosingCtx, {
      type: 'bar',
      data: {
        labels: Object.keys(dosingTypes),
        datasets: [{
          label: 'Doses',
          data: Object.values(dosingTypes),
          backgroundColor: 'rgba(58,166,255,0.75)',
          borderColor: '#3aa6ff',
          borderWidth: 2
        }]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{ labels:{ color:'#e4e6eb' } } },
        scales:{
          y:{ beginAtZero:true, grid:{ color:gridColor }, ticks:{ color:tickColor, stepSize:2 } },
          x:{ grid:{ color:gridColor }, ticks:{ color:tickColor, autoSkip:true, maxRotation:0 } }
        }
      }
    });

    // ====== Weekly Activity Timeline (bar) ======
    const activityByDate = {};
    aquariumData.forEach(d => { activityByDate[d.date] = (activityByDate[d.date] || 0) + 1; });
    const actLabels = Object.keys(activityByDate);
    const actValues = Object.values(activityByDate);
    const activityCtx = document.getElementById('activityChart').getContext('2d');
    new Chart(activityCtx, {
      type: 'bar',
      data: { labels: actLabels, datasets: [{ label:'Total Activities', data: actValues, backgroundColor:'rgba(58,166,255,0.6)', borderColor:'#3aa6ff', borderWidth:1 }] },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{ labels:{ color:'#e4e6eb' } } },
        scales:{
          y:{ beginAtZero:true, grid:{ color:gridColor }, ticks:{ color:tickColor, stepSize:1 } },
          x:{ grid:{ color:gridColor }, ticks:{ color:tickColor, autoSkip:true, maxRotation:0, callback:(v, i)=> (i%2===0? fmtDate(actLabels[i]) : '') } }
        }
      }
    });

    // ====== Milestones ======
    const milestones = aquariumData.filter(d => d.milestone || d.type === 'Checkpoint');
    const milestonesHTML = milestones.map(m => `
      <div class="timeline-item milestone">
        <div class="timeline-date">${m.date}</div>
        <div class="timeline-type">${m.type}</div>
        <div class="timeline-content"><strong>${m.detail}</strong><br/>${m.notes || ''}</div>
      </div>
    `).join('');
    document.getElementById('milestones').innerHTML = milestonesHTML;

    // ====== Recent Activity (last 15) ======
    const recentActivity = aquariumData.slice(-15).reverse();
    const activityHTML = recentActivity.map(a => `
      <div class="timeline-item">
        <div class="timeline-date">${a.date}</div>
        <div class="timeline-type">${a.type}</div>
        <div class="timeline-content"><strong>${a.detail}</strong><br/>${a.notes || ''}</div>
      </div>
    `).join('');
    document.getElementById('recentActivity').innerHTML = activityHTML;
  </script>
  <script src="/js/footer-loader.js?v=1.5.2" defer></script>
  <section class="legal-links" aria-label="Site legal links">
    <a href="/privacy-legal.html">Privacy Policy</a>
    <a href="/terms.html">Terms</a>
    <a href="/contact-feedback.html">Contact</a>
  </section>
  <noscript>
    <section class="legal-links" aria-label="Site legal links (noscript)">
      <a href="/privacy-legal.html">Privacy Policy</a>
      <a href="/terms.html">Terms</a>
      <a href="/contact-feedback.html">Contact</a>
    </section>
  </noscript>

  <div id="site-footer" data-footer-src="/footer.html?v=1.5.2"></div>
<!-- === TTG CMP Consent Bridge START === -->
<script>
(function(){
  // Helper: map TCF consent to our single "ads granted" flag.
  // We consider "granted" only when Purpose 1 (storage) AND Purpose 4 (select personalised ads)
  // are consented. If you want to allow NON-personalised ads when only Purpose 1 is granted,
  // set allowNPA=true below.
  var allowNPA = true; // if true, we‚Äôll treat Purpose 1 only as "granted" for showing slots (Google will serve NPA ads).

  function setAdConsent(granted){
    // Google CMP interface (Funding Choices) ‚Äî set consent for ads_storage and ad_user_data
    var consentState = granted ? 'granted' : 'denied';
    var payload = {
      'ad_storage': consentState,
      'ad_user_data': consentState,
      'ad_personalization': consentState
    };
    if (typeof window.__ttgUpdateConsentState__ === 'function') {
      window.__ttgUpdateConsentState__(payload);
    } else if (typeof window.gtag === 'function') {
      window.gtag('consent', 'update', payload);
    } else {
      (window.__ttgDeferredConsentUpdates__ = window.__ttgDeferredConsentUpdates__ || []).push(payload);
    }
  }

  function hookTCF(){
    // Funding Choices exposes the IAB TCF v2 interface.
    // We hook into it to map Purpose consent to Google consent mode.
    if (typeof __tcfapi !== 'function') return;

    __tcfapi('addEventListener', 2, function(tcData, success){
      if(!success || !tcData || tcData.eventStatus !== 'tcloaded') return;

      // Purpose IDs: 1 = Storage and Access, 4 = Select Personalised Ads
      var p1 = tcData.purpose && tcData.purpose.consents ? tcData.purpose.consents[1] : false;
      var p4 = tcData.purpose && tcData.purpose.consents ? tcData.purpose.consents[4] : false;

      var granted = allowNPA ? (p1 && (p4 || true)) : (p1 && p4);
      setAdConsent(granted);
    });
  }

  // Initialize once Funding Choices loads the TCF stub
  if (typeof __tcfapi === 'function') {
    hookTCF();
  } else {
    window.addEventListener('tcfapiReady', hookTCF, { once: true });
  }
})();
</script>
<!-- === TTG CMP Consent Bridge END === -->
</body>
</html>
