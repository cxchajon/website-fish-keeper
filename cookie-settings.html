<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cookie Settings — The Tank Guide</title>
  <meta name="description" content="Manage your cookie preferences for The Tank Guide. Update consent for analytics and advertising cookies anytime." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="canonical" href="https://thetankguide.com/cookie-settings.html" />
  <link rel="stylesheet" href="/css/style.css?v=1.0.9" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script defer src="/js/nav.js?v=1.1.0"></script>
  <style>
    body.theme-light { background: radial-gradient(circle at top, rgba(15,51,82,.9), rgba(7,18,32,1)); color: #fff; }
    main.cookie-settings { max-width: 720px; margin: 0 auto; padding: 72px 20px 96px; text-align: left; }
    .cookie-settings h1 { margin: 0 0 12px; font-size: clamp(32px, 4vw, 44px); }
    .cookie-settings p { margin: 0 0 16px; line-height: 1.6; color: rgba(255,255,255,.88); }
    .cookie-actions { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 24px; }
    .cookie-actions button { border-radius: 12px; border: 1px solid rgba(255,255,255,.2); background: rgba(255,255,255,.08); color: #fff; padding: 12px 18px; font-weight: 600; cursor: pointer; }
    .cookie-actions button:hover { background: rgba(255,255,255,.16); }
  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9905718149811880"
    crossorigin="anonymous"></script>
</head>
<body class="theme-light">
  <div id="site-nav"></div>
  <main class="cookie-settings" aria-labelledby="cookie-settings-title">
    <h1 id="cookie-settings-title">Cookie Settings</h1>
    <p>You can review and change your cookie consent choices for The Tank Guide at any time. Use the buttons below to reopen the cookie preferences banner or reset your saved selections.</p>
    <p>Essential cookies are required to run the site. Analytics and advertising cookies are optional and will only load if you grant consent.</p>
    <div class="cookie-actions">
      <button type="button" id="cookie-open-modal">Manage preferences</button>
      <button type="button" id="cookie-reset">Reset consent</button>
    </div>
  </main>

  <div id="site-footer"></div>
  <script>
(async () => {
  try {
    const res = await fetch('/footer.v1.3.0.html?v=1.3.0', { cache: 'no-cache' });
    const html = await res.text();
    const host = document.getElementById('site-footer');
    if (host) host.outerHTML = html;
  } catch (e) { console.error('[Footer] load failed:', e); }
})();
  </script>

<!-- === TTG Cookie Consent START === -->
<div id="ttg-consent" class="ttg-consent" hidden>
  <div class="ttg-consent__inner" role="dialog" aria-labelledby="ttg-consent-title" aria-describedby="ttg-consent-desc">
    <h3 id="ttg-consent-title">Cookies & Advertising</h3>
    <p id="ttg-consent-desc">
      We use cookies to run this site and (if you allow) to show relevant ads from Google AdSense. You can accept all cookies, reject personalized ads, or manage preferences anytime.
    </p>
    <div class="ttg-consent__actions">
      <button type="button" class="ttg-btn ttg-btn--secondary" id="ttg-consent-reject">Reject (Non-personalized)</button>
      <button type="button" class="ttg-btn ttg-btn--ghost" id="ttg-consent-manage">Manage</button>
      <button type="button" class="ttg-btn ttg-btn--primary" id="ttg-consent-accept">Accept All</button>
    </div>
  </div>
</div>

<div id="ttg-consent-modal" class="ttg-consent-modal" hidden aria-modal="true" role="dialog" aria-labelledby="ttg-consent-modal-title">
  <div class="ttg-consent-modal__panel">
    <h3 id="ttg-consent-modal-title">Cookie Preferences</h3>
    <form id="ttg-consent-form">
      <label class="ttg-row">
        <input type="checkbox" checked disabled />
        <span><strong>Essential</strong> — required for core site functions.</span>
      </label>
      <label class="ttg-row">
        <input type="checkbox" id="ttg-c-analytics" />
        <span><strong>Analytics</strong> — understand usage (if enabled later).</span>
      </label>
      <label class="ttg-row">
        <input type="checkbox" id="ttg-c-ads" />
        <span><strong>Advertising</strong> — allow personalized ads (Google AdSense).</span>
      </label>
      <div class="ttg-consent-modal__actions">
        <button type="button" class="ttg-btn ttg-btn--ghost" id="ttg-consent-cancel">Cancel</button>
        <button type="submit" class="ttg-btn ttg-btn--primary">Save</button>
      </div>
      <p class="ttg-consent-status" hidden></p>
    </form>
  </div>
</div>

<style>
  .ttg-consent { position: fixed; inset: auto 16px 16px; z-index: 9999; max-width: 380px; background: rgba(8, 20, 36, 0.94); color: #fff; border-radius: 16px; box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35); padding: 20px; display: grid; gap: 14px; }
  .ttg-consent[hidden] { display: none !important; }
  .ttg-consent h3 { margin: 0; font-size: 18px; }
  .ttg-consent p { margin: 0; font-size: 14px; line-height: 1.5; opacity: 0.9; }
  .ttg-consent__actions { display: grid; gap: 10px; }
  .ttg-btn { border-radius: 12px; padding: 12px 16px; font-weight: 600; cursor: pointer; }
  .ttg-btn--primary { background: #1e90ff; color: #fff; border: none; }
  .ttg-btn--secondary { background: rgba(255,255,255,0.1); color: #fff; border: none; }
  .ttg-btn--ghost { background: transparent; color: #fff; border: 1px solid rgba(255,255,255,0.22); }
  .ttg-consent-modal { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(5, 12, 22, 0.8); z-index: 10000; }
  .ttg-consent-modal[hidden] { display: none !important; }
  .ttg-consent-modal__panel { background: #081426; color: #fff; border-radius: 18px; padding: 28px; width: min(480px, 92%); display: grid; gap: 18px; }
  .ttg-consent-modal__panel h3 { margin: 0; font-size: 20px; }
  .ttg-consent-modal__panel form { display: grid; gap: 14px; }
  .ttg-row { display: flex; gap: 12px; align-items: flex-start; font-size: 14px; }
  .ttg-row input { margin-top: 3px; }
  .ttg-consent-modal__actions { display: flex; gap: 12px; justify-content: flex-end; }
  .ttg-consent-status { margin: 0; font-size: 13px; opacity: 0.8; }
  @media (max-width: 540px) {
    .ttg-consent { inset: auto 12px 12px; padding: 18px; }
    .ttg-consent-modal__panel { padding: 24px; }
  }
</style>

<script>
(() => {
  const KEY = 'ttg.consent.v1';

  const $banner = document.getElementById('ttg-consent');
  const $modal  = document.getElementById('ttg-consent-modal');
  const $btnAccept = document.getElementById('ttg-consent-accept');
  const $btnReject = document.getElementById('ttg-consent-reject');
  const $btnManage = document.getElementById('ttg-consent-manage');
  const $btnCancel = document.getElementById('ttg-consent-cancel');
  const $form = document.getElementById('ttg-consent-form');

  const $rows        = $form ? $form.querySelectorAll('.ttg-row') : [];
  const $ckEssential = $rows[0] ? $rows[0].querySelector('input[type="checkbox"]') : null;
  const $ckAnalytics = document.getElementById('ttg-c-analytics');
  const $ckAds       = document.getElementById('ttg-c-ads');

  let $status = $form ? $form.querySelector('.ttg-consent-status') : null;
  if ($form && !$status){
    $status = document.createElement('p');
    $status.className = 'ttg-consent-status';
    $form.appendChild($status);
  }

  function updateStatus(){
    if(!$status) return;
    const a = $ckAnalytics && $ckAnalytics.checked ? 'ON' : 'OFF';
    const d = $ckAds && $ckAds.checked ? 'ON' : 'OFF';
    $status.textContent = `Current: Analytics ${a} • Advertising ${d}`;
  }

  function save(state){
    localStorage.setItem(KEY, JSON.stringify(state));
    document.documentElement.setAttribute('data-ad-consent', state.ads ? 'granted' : 'denied');
  }
  function load(){
    try { return JSON.parse(localStorage.getItem(KEY) || ''); } catch(e){ return null; }
  }
  function openBanner(){ if ($banner) $banner.hidden = false; }
  function closeBanner(){ if ($banner) $banner.hidden = true; }
  function openModal(){
    if(!$modal) return;
    $modal.hidden = false;

    if ($ckEssential){
      $ckEssential.checked = true;
      $ckEssential.disabled = true;
    }

    const s = load() || {analytics:false, ads:false};
    if ($ckAnalytics) $ckAnalytics.checked = !!s.analytics;
    if ($ckAds)       $ckAds.checked = !!s.ads;
    updateStatus();
  }
  function closeModal(){ if($modal) $modal.hidden = true; }

  closeModal();

  const state = load();
  if (!state){
    openBanner();
  } else {
    document.documentElement.setAttribute('data-ad-consent', state.ads ? 'granted' : 'denied');
  }

  if ($btnAccept){
    $btnAccept.addEventListener('click', () => {
      save({ analytics: true, ads: true });
      closeModal();
      closeBanner();
    });
  }
  if ($btnReject){
    $btnReject.addEventListener('click', () => {
      save({ analytics: false, ads: false });
      closeModal();
      closeBanner();
    });
  }
  if ($btnManage){
    $btnManage.addEventListener('click', () => {
      closeBanner();
      openModal();
    });
  }
  if ($btnCancel){
    $btnCancel.addEventListener('click', () => {
      closeModal();
    });
  }
  if ($form){
    $form.addEventListener('submit', (event) => {
      event.preventDefault();
      save({
        analytics: $ckAnalytics ? !!$ckAnalytics.checked : false,
        ads: $ckAds ? !!$ckAds.checked : false,
      });
      closeModal();
    });
  }
  if ($modal){
    $modal.addEventListener('click', (event) => {
      if (event.target === $modal){
        closeModal();
      }
    });
  }
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && $modal && !$modal.hidden) closeModal();
  });

  if (document.documentElement.getAttribute('data-ad-consent') !== 'granted'){
    window.__TTG_ADS_DISABLED__ = true;
  }

  window.cookieConsent = {
    open: function(){ openModal(); },
    reset: function(){ localStorage.removeItem(KEY); closeModal(); openBanner(); }
  };
})();
</script>
<!-- === TTG Cookie Consent END === -->

<script>
  document.getElementById('cookie-open-modal')?.addEventListener('click', () => {
    window.cookieConsent && window.cookieConsent.open();
  });
  document.getElementById('cookie-reset')?.addEventListener('click', () => {
    window.cookieConsent && window.cookieConsent.reset();
  });
  window.addEventListener('load', () => {
    if (window.cookieConsent && localStorage.getItem('ttg.consent.v1')) {
      window.cookieConsent.open();
    }
  });
</script>
</body>
</html>
